@(message: String,receiptForm: Form[dummy.DummyReceipt])

@import helper._
@import dummy.HTMLGenerator
@main("Create Receipt") {
    @form(routes.Application.submitReceipt()){

	<div id="page-wrap">

		<textarea id="header">INVOICE</textarea>
		
		<div id="identity">
		
            <textarea id="address">Chris Coyier
				123 Appleseed Street
				Appleville, WI 53719
	
				Phone: (555) 555-5555</textarea>

            <div id="logo">

              <div id="logoctr">
                <a href="javascript:;" id="change-logo" title="Change logo">Change Logo</a>
                <a href="javascript:;" id="save-logo" title="Save changes">Save</a>
                |
                <a href="javascript:;" id="delete-logo" title="Delete logo">Delete Logo</a>
                <a href="javascript:;" id="cancel-logo" title="Cancel changes">Cancel</a>
              </div>

              <div id="logohelp">
                <input id="imageloc" type="text" size="50" value="" /><br />
                (max width: 540px, max height: 100px)
              </div>
              <img id="image" src="images/logo.png" alt="logo" />
            </div>
		
		</div>
		
		<div style="clear:both"></div>
		
		<div id="customer">

            <textarea id="customer-title">Widget Corp.
			c/o Steve Widget</textarea>

            <table id="meta">
                <tr>
                    <td class="meta-head">Invoice #</td>
                    <td><textarea>000123</textarea></td>
                </tr>
                <tr>

                    <td class="meta-head">Date</td>
                    <td><textarea id="date">December 15, 2009</textarea></td>
                </tr>
                <tr>
                    <td class="meta-head">Amount Due</td>
                    <td><div class="due">$0</div></td>
                </tr>

            </table>
		
		</div>
		
		<table id="items">
		
		  <tr>
		      <th>Item</th>
		      <th>Description</th>
		      <th>Unit Cost</th>
		      <th>Quantity</th>
		      <th>Price</th>
		  </tr>
		  
		  	  
		  <tr class="item-row">
		      <td class="item-name"><div class="delete-wpr">		      
		       @select(
		      receiptForm("product.id"),
		      options(Product.getProductsAsMap),
		      '_label -> "Product",
		      '_default -> "-- Choose a Product --",
		      'id->"prod",
		      'onChange->"setPriceAndName(this)"
		    )
		      
		      <a class="delete" href="javascript:;" title="Remove row">X</a></div></td>
		      <td class="description"><textarea></textarea></td>
		      <td><textarea class="cost" id="cost">$0</textarea></td>
		      <td><textarea class="qty">1</textarea></td>
		      <td><span class="price">$0</span></td>
		  </tr>
		  <tr id="hiderow">
		    <td colspan="5"><a id="addrow" href="javascript:;" title="Add a row">Add a row</a></td>
		  </tr>
		  
		  <tr>
		      <td colspan="2" class="blank"> </td>
		      <td colspan="2" class="total-line">Subtotal</td>
		      <td class="total-value"><div id="subtotal">$0</div></td>
		  </tr>
		  <tr>

		      <td colspan="2" class="blank"> </td>
		      <td colspan="2" class="total-line">Total</td>
		      <td class="total-value"><div id="total">$0</div></td>
		  </tr>
		  <tr>
		      <td colspan="2" class="blank"> </td>
		      <td colspan="2" class="total-line">Amount Paid</td>

		      <td class="total-value"><textarea id="paid">$0.00</textarea></td>
		  </tr>
		  <tr>
		      <td colspan="2" class="blank"> </td>
		      <td colspan="2" class="total-line balance">Balance Due</td>
		      <td class="total-value balance"><div class="due">$0</div></td>
		  </tr>
		
		</table>
		
		<div id="terms">
		  <h5>Terms</h5>
		  <textarea>NET 30 Days. Finance Charge of 1.5% will be made on unpaid balances after 30 days.</textarea>
		</div>
	
	</div>
	}
    <script>
    
    function setPriceAndName(selected){
    	//alert(selected.value);
    	
    	$.ajax({
            type : "GET",
            url : "@routes.Application.getProductById()",
            data : "productId="+selected.value,
        	success: function(data){
        		bind();
        		 $('table[id*="items"] tbody tr.item-row:last td textarea.cost:last').val(data);
        		//document.getElementById("cost").value = data;
				//$("#cost").trigger('blur');
				bind();
				  $('table[id*="items"] tbody tr.item-row:last td textarea#cost:last').trigger('blur');
				  bind();
			}
        });
    }
    
    $(document).ready(function() {

    	  $('input').click(function(){
    	    $(this).select();
    	  });

    	  $("#paid").blur(update_balance);
    	   
    	  $("#addrow").click(function(){
    		  
    		  $.ajax({
    	            type : "GET",
    	            url : "@routes.Application.getHTML()",
    	            
    	        	success: function(data){
    	        		$(".item-row:last").after(data);    		    					
    				}
    		  });
    	    
    	    if ($(".delete").length > 0) $(".delete").show();
    	    bind();
    	  });
    	  
    	  bind();
    	  
    	  $(".delete").live('click',function(){
    	    $(this).parents('.item-row').remove();
    	    update_total();
    	    if ($(".delete").length < 2) $(".delete").hide();
    	  });
    	  
    	  $("#cancel-logo").click(function(){
    	    $("#logo").removeClass('edit');
    	  });
    	  $("#delete-logo").click(function(){
    	    $("#logo").remove();
    	  });
    	  $("#change-logo").click(function(){
    	    $("#logo").addClass('edit');
    	    $("#imageloc").val($("#image").attr('src'));
    	    $("#image").select();
    	  });
    	  $("#save-logo").click(function(){
    	    $("#image").attr('src',$("#imageloc").val());
    	    $("#logo").removeClass('edit');
    	  });
    	  
    	  $("#date").val(print_today());
    	  
    	});
    </script>
}
